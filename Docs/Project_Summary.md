# 프로젝트 종합 요약 (Project Comprehensive Summary)

`DN_solution` 프로젝트는 Django와 Django REST Framework를 기반으로 구축된 백엔드 시스템으로, 4계층 구조의 업체 및 사용자 관리, 주문 처리, 정책 관리 기능을 제공합니다. 이 문서는 프로젝트의 전반적인 구조, 핵심 기능, 백엔드 및 프론트엔드 전략, 개발 원칙, 그리고 미래 방향에 대한 종합적인 요약을 제공합니다.

## 1. 프로젝트 개요 및 목표

`DN_solution`은 다양한 유형의 업체(본사, 협력사, 대리점, 판매점)와 그 소속 사용자들을 효율적으로 관리하고, 이들 간의 계층적 관계 및 접근 권한을 체계적으로 제어하는 것을 목표로 합니다. 현재는 RESTful API 백엔드 개발에 중점을 두고 있으며, 향후 프론트엔드 애플리케이션과의 연동을 통해 완전한 서비스를 제공할 예정입니다.

### 1.1. 최신 구현 사항 (2025-01-XX)

#### 4계층 구조 시스템 구현
- **계층 구조**: DBA → 본사 → (협력사/대리점) → 판매점
- **업체 코드 시스템**: 각 업체에 고유한 코드 부여 (예: `HQ_MAIN`, `AGENCY_001`, `DEALER_001`, `RETAIL_001`)
- **대리점 모델 분리**: 협력사와 같은 level이지만 다른 기능을 하는 별도 `Dealer` 모델
- **계층별 회원가입**: 상위 업체 코드를 통한 계층 구조 검증
- **승인 워크플로우**: 상위 업체 관리자가 하위 업체 사용자 승인/거절
- **권한 기반 접근 제어**: 업체 유형에 따른 승인 권한 차등화

#### 관리자/직원 구분 시스템
- **역할 구분**: 관리자(`admin`)와 직원(`staff`) 역할 분리
- **승인 권한**: 관리자만 하위 사용자 승인 가능
- **조회 권한**: 직원은 제한된 데이터만 조회 가능

## 2. 시스템 아키텍처 및 구조

프로젝트는 클라이언트-서버 아키텍처를 따르며, Django 기반의 백엔드 서버와 잠재적인 프론트엔드 앱으로 구성됩니다. 모듈화된 설계를 통해 각 비즈니스 도메인(예: `companies`, `orders`, `policies`)을 독립적인 Django 앱으로 분리하여 유지보수성과 확장성을 확보했습니다.

*   **백엔드:** Django (Python) 및 Django REST Framework를 사용하여 RESTful API를 제공합니다.
*   **데이터베이스:** Django ORM을 통해 상호작용하며, SQLite (개발) 또는 PostgreSQL/MySQL (운영)을 지원합니다.
*   **프론트엔드:** React 기반의 SPA로 구현되어 있으며, 계층별 승인 시스템을 위한 직관적인 UI를 제공합니다.
*   **문서화:** 모든 프로젝트 문서는 `docs/` 디렉토리에 체계적으로 정리되어 있습니다.

## 3. 핵심 기능 및 로직

### 3.1. 업체 및 사용자 관리 (`companies` 앱)

#### 4계층 구조 모델
*   **`Company` 모델:** 본사-협력사-판매점의 3단계 계층 구조를 `parent_company` 필드를 통해 구현합니다.
*   **`Dealer` 모델:** 본사 하위의 대리점을 별도 모델로 관리하며, 협력사와 같은 level이지만 다른 기능을 제공합니다.
*   **계층별 생성 규칙:** `models.py`의 `clean` 메서드를 통해 계층별 생성 규칙을 강제하여 데이터 무결성을 보장합니다.

#### 업체 코드 시스템
*   **자동 코드 생성**: 각 업체 생성 시 고유한 코드 자동 부여
*   **계층별 코드 체계**: 업체 유형별로 구분된 코드 체계 (예: `HQ_`, `AGENCY_`, `DEALER_`, `RETAIL_`)

#### 사용자 관리 시스템
*   **`CompanyUser` 모델:** 각 업체/대리점에 소속된 사용자를 `admin` 또는 `staff` 역할로 관리
*   **승인 상태 관리**: `pending`, `approved`, `rejected` 상태 추적
*   **소속 조직 선택**: 사용자는 업체 또는 대리점 중 하나에만 소속 가능

#### 권한 제어 시스템
*   **계층별 접근 제어**: `CompanyViewSet`의 `get_queryset` 메서드에서 로그인한 사용자의 역할에 따라 조회 가능한 업체 및 사용자 목록을 동적으로 필터링
*   **승인 권한 차등화**: 
    - 본사 관리자: 모든 사용자 승인 가능
    - 협력사 관리자: 하위 판매점 사용자만 승인 가능
    - 대리점 관리자: 승인 권한 없음 (조회만 가능)
    - 판매점 관리자: 직원 승인만 가능

#### 계층별 승인 시스템
*   **상위 업체 승인**: 상위 업체 관리자가 하위 업체 사용자의 가입을 승인/거절
*   **승인 권한 검증**: `can_be_approved_by` 메서드를 통한 승인 권한 검증
*   **승인 워크플로우**: 승인 대기 → 승인/거절 → 상태 변경

### 3.2. 주문 관리 (`orders` 앱)

*   고객 주문 정보, 주문 메모, 송장 정보 등을 관리하며, 주문 상태 변경 및 송장 생성 시 자동 업데이트 로직을 포함합니다.

### 3.3. 정책 관리 (`policies` 앱)

*   다양한 정책을 정의하고, 이를 특정 업체에 배정하며, 리베이트 계산 등의 로직을 처리합니다.

## 4. 초기 설정 및 관리

### 4.1 시스템 초기화
```bash
# 1. 가상환경 활성화
venv\Scripts\activate  # Windows
source venv/bin/activate  # Linux/Mac

# 2. 마이그레이션 실행
python manage.py migrate

# 3. 초기 관리자 계정 생성
python manage.py create_initial_admin

# 4. 서버 시작
python manage.py runserver
```

### 4.2 사용자 관리
- **Django Admin**: `http://your-domain:8000/admin/` (admin / admin1234)
- **승인 시스템**: 계층별 승인 권한 체계
- **데이터 정리**: `python manage.py cleanup_data --confirm`
- **전체 데이터 삭제**: `python manage.py wipe_all_data --confirm`

### 4.3 관련 문서
- `docs/Initial_Setup_and_User_Management.md`: 초기 설정 및 사용자 관리 가이드
- `docs/Django_Admin_Configuration.md`: Django Admin 설정 및 관리 가이드
- `docs/System_Architecture_and_Flow.md`: 시스템 아키텍처 및 데이터 흐름

## 5. 개발 실천 가이드라인

프로젝트의 모든 코드는 높은 품질과 유지보수성을 위해 다음과 같은 원칙을 준수합니다.

*   **핵심 코딩 원칙:** 단일 책임 원칙(SRP), GoF 디자인 패턴 활용, 애자일 개발 방법론 준수.
*   **클린 코드:** 명확하고 의도적인 이름 지정, `Why`를 설명하는 주석, 로직의 단순화 및 복잡성 제한.
*   **로깅 전략:** `DEBUG`, `INFO`, `WARNING`, `ERROR`, `CRITICAL` 레벨을 활용하여 모든 과정과 통신 내용을 상세하게 기록합니다. 특히, 테스트 코드 실행 시에도 상세한 로그를 파악할 수 있도록 로깅 설정을 명시합니다.
*   **엣지 케이스 및 예외 처리:** 예상치 못한 상황과 오류를 사전에 식별하고, 모델/시리얼라이저/뷰 레벨의 유효성 검증, `try-except` 블록, 중앙 집중식 오류 처리(DRF `EXCEPTION_HANDLER`)를 통해 안정적으로 처리합니다.
*   **확장성 고려:** 기능, 데이터, 시스템 수준에서의 확장성을 고려하여 모듈화, 추상화, 설정 기반 확장 등을 적용합니다.
*   **테스트 용이성:** 모든 코드는 독립적으로 테스트 가능하도록 설계하며, 충분한 테스트 커버리지를 확보합니다.
*   **협업 및 일관성:** PEP 8 준수, 코드 포매터/린터 사용, 통일된 명명 규칙을 통해 협업 효율을 높입니다.

## 6. UI 접근 제어 전략

백엔드 권한을 시각적으로 반영하고 사용자 경험을 개선하기 위해 프론트엔드에서 역할 기반의 UI 접근 제어를 구현합니다.

*   **조건부 렌더링:** 사용자의 역할에 따라 메뉴, 버튼, 데이터 테이블, 폼 필드 등을 동적으로 표시하거나 숨깁니다.
*   **동적 라우팅/내비게이션:** 라우트 가드를 사용하여 역할에 따른 페이지 접근을 제어합니다.
*   **계층별 회원가입 UI:** 업체 유형에 따라 상위 업체 코드 입력 필드를 동적으로 표시/숨김 처리합니다.
*   **관리자/직원 구분 UI:** 회원가입 시 관리자/직원 선택 기능 제공
*   **보안 경고:** UI 제어는 보조적인 보안 계층이며, 백엔드에서의 철저한 권한 검증이 필수적입니다.

## 7. 확장성 및 미래 방향

프로젝트는 새로운 업체 유형, 사용자 역할, 주문 상태, 정책 유형 추가 등 기능적 확장을 용이하게 설계되었습니다. 또한, API 확장, 데이터베이스 확장, 성능 확장(캐싱, 비동기 처리, 로드 밸런싱)을 고려합니다. 향후 프론트엔드 통합, 알림 시스템, 보고서/통계 기능, 외부 서비스 연동 등으로 발전할 수 있습니다.

### 7.1. 향후 개선 계획

*   **회원가입 프로세스 개선**: 관리자/직원 구분 선택, 업체 코드 자동 생성
*   **대리점 전용 기능**: 대리점만의 특별한 기능 및 권한 구현
*   **알림 시스템:** 승인 요청, 승인 완료 등의 이벤트에 대한 실시간 알림
*   **대시보드:** 각 업체별 통계 및 현황 대시보드
*   **모바일 앱:** React Native를 활용한 모바일 애플리케이션
*   **API 문서화:** Swagger/OpenAPI를 활용한 자동 API 문서 생성

## 8. 결론

`DN_solution` 프로젝트는 견고한 아키텍처, 세밀한 권한 제어, 그리고 명확한 개발 가이드라인을 통해 높은 품질과 유지보수성을 확보합니다. 특히 4계층 구조와 대리점 모델 분리를 통해 더욱 세밀한 업체 관리가 가능해졌으며, 관리자/직원 구분 시스템으로 역할 기반 접근 제어를 강화했습니다. 이는 다양한 계층의 업체 및 사용자 관리를 효율적으로 지원하며, 미래의 비즈니스 요구사항 변화에 유연하게 대응할 수 있는 강력한 기반을 제공합니다.
